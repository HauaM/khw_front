
[역할(Role)]
당신은 광주은행(KJB) 내부 시스템용 "KWH 지식관리시스템"을 개발하는
시니어 React + TypeScript + Tailwind CSS 프론트엔드 엔지니어입니다.

---

[목표(Goal)]
정적 HTML 파일 `07_메뉴얼상세조회_v2.html` 을 참고하여,
React + TypeScript + Tailwind 기반으로 다음 화면을 구현하세요.

- 화면명: "승인된 메뉴얼" (Approved Manuals List / Cards)
- 기능 1) business_type + error_code 기준으로 승인된 메뉴얼 카드 목록을 로딩해 렌더링
- 기능 2) 카드 우측 상단 버튼으로 "상담 원본 보기" 모달을 열 수 있음
- 기능 3) 화면 진입 시 manual_id를 받으면 해당 manual_id의 카드 섹션으로 자동 스크롤됨
  - 스크롤 시 해당 카드가 3초 동안 하이라이트(border-primary + shadow)되고 자동 해제
- 기능 4) 우측 상단 입력창에 manual_id를 입력하고 "이동" 버튼(또는 Enter)으로 동일하게 스크롤 이동 가능

---

[반드시 참조할 HTML 파일]
- `07_메뉴얼상세조회_v2.html` 을 반드시 열고 UI 구조/문구/동작을 그대로 따라가세요. :contentReference[oaicite:1]{index=1}

이 HTML에서 확인되는 핵심 동작(요약):
- `fetchManuals(businessType, errorCode)`로 승인된 메뉴얼 목록을 로딩(현재는 mock + 500ms)
- 카드 DOM id는 `manual-${manual.id}`
- `scrollToManual(manualId)`가:
  1) element를 찾고
  2) `scrollIntoView({behavior:'smooth', block:'center'})`
  3) state.targetManualId로 하이라이트
  4) 3초 후 하이라이트 해제
- URL query로 `?manual_id=...`가 들어오면 자동으로 targetManualId에 세팅 후 로딩 완료 뒤 자동 스크롤

이 UX를 React/TS에서 동일하게 구현하세요.

---

[중요 제약(반드시 준수)]
이 작업은 "메인 콘텐츠 영역" 구현 작업입니다.
따라서 아래 공통 레이아웃 영역은 새로 만들거나 수정하지 말고, 프로젝트에 이미 존재하는 컴포넌트를 그대로 사용하세요.

- `src/layouts/AppLayout.tsx` (또는 동일 역할 파일)
- `src/components/layout/AppHeader.tsx`
- `src/components/layout/AppSidebar.tsx`

즉, 이번 작업에서 생성/수정하는 화면은 반드시 아래 형태로 구현되어야 합니다.

- 페이지 컴포넌트(예: `ApprovedManualCardsPage`)는
  `AppLayout` 내부에 "메인 콘텐츠(children)"로 렌더되는 구조를 전제로 합니다.
- 페이지 컴포넌트는 헤더/사이드바의 HTML/CSS/마크업을 포함하면 안 됩니다.
- 페이지 컴포넌트는 오직 `main` 또는 `content` 영역의 UI만 구현합니다.
- 라우터(AppRouter)에서는 기존 레이아웃 래핑 방식(예: `<AppLayout><Page/></AppLayout>`)
  또는 이미 구축된 라우팅 규칙을 그대로 따르세요.

(이 제약은 매우 중요하며, 위 파일들을 새로 생성하거나 중복 구현하면 실패입니다.)

---

[라우팅/파라미터 규칙]
- 페이지 경로(예시): `/manuals/approved`
- 이 페이지는 두 방식으로 manual_id를 받을 수 있어야 합니다.
  1) query string: `/manuals/approved?manual_id=<uuid>`
  2) route param도 지원 가능(선택): `/manuals/approved/:manualId`
  - 둘 다 들어오면 query string을 우선

- business_type / error_code는 우선 mock으로 고정값 사용해도 됩니다.
  - 기본값(HTML 기준): business_type='INTERNET_BANKING', error_code='E001'
  - 추후 라우팅 또는 상위 화면에서 전달받아 교체 가능하도록 구조를 만들어주세요.

---

[API 연결 설계(현재는 mock)]
향후 백엔드 API를 붙일 것을 고려해 다음 형태로 분리하세요.

1) 승인 메뉴얼 목록
- `GET /api/v1/manuals/versions?business_type=...&error_code=...&status=APPROVED`
  (또는 프로젝트 실제 API에 맞게 TODO 주석)
- 현재는 mock 데이터(setTimeout 500ms)로 대체

2) 상담 원본 조회
- `GET /api/v1/consultations/:consultationId`
- 현재는 mock 데이터(setTimeout 300ms)로 대체

---

[TypeScript 타입 정의]
아래 타입으로 정리하고, HTML의 필드명(id, keywords, topic, background, guideline 등)을 그대로 매핑하세요.

type ManualStatus = "APPROVED" | "DEPRECATED" | string;

type BusinessType =
  | "INTERNET_BANKING"
  | "MOBILE_BANKING"
  | "ACCOUNT"
  | "LOAN"
  | "CARD"
  | "SECURITY"
  | string;

interface ManualCardItem {
  id: string; // manual_id 역할
  keywords: string[];
  topic: string;
  background: string;
  guideline: string; // "\n" 기준 step 분리
  business_type: BusinessType;
  error_code: string;
  source_consultation_id: string;
  version_id: string;
  status: ManualStatus;
  business_type_name?: string;
  created_at: string;
  updated_at: string;
}

interface ConsultationDetail {
  id: string;
  summary: string;
  inquiry: string;
  action: string;
  created_at: string;
}

---

[생성/수정해야 할 파일]
다음 파일들을 생성/수정해서 구현하세요. (없으면 생성)

1) 페이지
- `src/pages/manuals/ApprovedManualCardsPage.tsx`
  - 카드 목록 전체 화면, manual_id 파라미터 처리, 자동 스크롤 오케스트레이션

2) 컴포넌트
- `src/components/manuals/ApprovedManualHeader.tsx`
  - 제목/부제 + manual_id 입력 + "이동" 버튼(Enter 처리 포함)
- `src/components/manuals/ApprovedManualCardList.tsx`
  - 카드 리스트 렌더 (map)
  - 각 카드에 ref 또는 id 부여(스크롤 대상)
- `src/components/manuals/ApprovedManualCard.tsx`
  - 카드 단위 UI
  - "상담 원본 보기" 버튼 클릭 이벤트
  - 하이라이트 상태(선택된 카드) 표현
- `src/components/consultations/ConsultationModal.tsx`
  - 상담 원본 모달 (Overlay 클릭 닫기 + X 버튼 닫기)

3) hooks
- `src/hooks/useApprovedManualCards.ts`
  - (businessType, errorCode)로 목록 로딩
  - isLoading/error/data 관리
- `src/hooks/useConsultationDetail.ts`
  - consultationId로 상담 원본 로딩

4) API 레이어
- `src/lib/api/manuals.ts`
  - `getApprovedManuals(params): Promise<ManualCardItem[]>` (현재 mock)
- `src/lib/api/consultations.ts`
  - `getConsultationDetail(consultationId): Promise<ConsultationDetail>` (현재 mock)

5) Router
- `src/routes/AppRouter.tsx` (또는 실제 라우터 파일)
  - `/manuals/approved` → `<ApprovedManualCardsPage />`

---

[핵심 요구사항: “manual_id로 자동 스크롤 + 하이라이트” 구현 방식]
반드시 React 방식으로 구현하세요(직접 DOM 조작 최소화).

1) 카드 ref 매핑
- `const cardRefs = useRef<Record<string, HTMLDivElement | null>>({});`
- 각 카드 렌더 시:
  - `<div ref={(el) => { cardRefs.current[item.id] = el; }} id={`manual-${item.id}`}>`

2) 스크롤 함수
- `scrollToManual(manualId: string)`:
  - 빈 값이면 Toast/Alert("Manual ID를 입력해주세요.") 처리
  - 대상 ref가 있으면:
    - `setHighlightedManualId(manualId)`
    - `requestAnimationFrame(() => ref.scrollIntoView({behavior:'smooth', block:'center'}))`
    - 3초 후 highlight 해제(단, 사용자가 다른 id로 이동하면 이전 타이머는 취소)

3) 자동 스크롤 트리거
- 데이터 로딩 완료 후, 아래 우선순위로 manualIdTarget 결정:
  1) query string manual_id
  2) route param manualId (선택 지원 시)
  3) 없으면 자동 스크롤 없음
- `useEffect`:
  - `if (data.length > 0 && manualIdTarget) scrollToManual(manualIdTarget);`
  - 단, 동일 manualIdTarget에 대해 중복 실행 방지(ref로 “한번만 실행” 플래그 관리)

4) “존재하지 않는 manual_id” 처리
- ref가 없으면 Toast/Alert:
  - "해당 Manual ID를 찾을 수 없습니다."
  - 가능하면 현재 화면에 있는 ID 일부를 같이 보여주는 UX도 구현(HTML처럼)
  - 단, 너무 길면 첫 5개만 보여주고 “외 N개” 처리

---

[UI 스타일(Tailwind)]
HTML의 톤을 유지합니다. (07_메뉴얼상세조회_v2.html에 정의된 Tailwind config 색상 primary/gray/etc 참고) :contentReference[oaicite:2]{index=2}

- 페이지 래퍼:
  - `flex h-full w-full flex-col gap-6 overflow-auto px-6 py-6`
- 헤더 영역:
  - 좌: 제목 "승인된 메뉴얼" + 부제 "업무구분/에러코드"
  - 우: manual_id 입력 + 이동 버튼
- 카드:
  - 기본: `rounded-lg border border-gray-200 bg-white p-4 shadow-sm transition-all`
  - 하이라이트: `border-primary-500 shadow-lg`
- 카드 헤더:
  - 상단 border-bottom
- 키워드 뱃지:
  - info 배지: `bg-info-light text-info` 느낌을 tailwind로 구현
- 배경/가이드라인 영역:
  - `rounded-md border border-gray-200 bg-gray-50 px-3 py-2`
- 모달:
  - overlay: `fixed inset-0 z-50 flex items-center justify-center bg-gray-900/50`
  - panel: `w-full max-w-2xl rounded-lg border border-gray-200 bg-white p-6 shadow-lg`

---

[버튼/배지 공용 컴포넌트]
프로젝트에 이미 Button/Badge 컴포넌트가 있다면 재사용하세요.
없다면 이번 작업에서 간단한 버전으로 새로 만들지 말고,
각 컴포넌트 파일 안에서 Tailwind 클래스로 구현해도 됩니다(단, 코드 중복 최소화).

---

[출력 형식(Output)]
아래 파일들의 “최종 전체 코드(덮어쓰기 가능)”를 생략 없이 순서대로 출력하세요.

1) `src/pages/manuals/ApprovedManualCardsPage.tsx`
2) `src/components/manuals/ApprovedManualHeader.tsx`
3) `src/components/manuals/ApprovedManualCardList.tsx`
4) `src/components/manuals/ApprovedManualCard.tsx`
5) `src/components/consultations/ConsultationModal.tsx`
6) `src/hooks/useApprovedManualCards.ts`
7) `src/hooks/useConsultationDetail.ts`
8) `src/lib/api/manuals.ts`
9) `src/lib/api/consultations.ts`
10) `src/routes/AppRouter.tsx` (변경된 부분 포함)

주의: 기존 파일이 존재할 수 있으니, 기존 export들을 최대한 유지하면서 필요한 내용을 추가하세요.